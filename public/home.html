<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solana Grand Prix – Home</title>

    <!-- Shared header/footer + background -->
    <link rel="stylesheet" href="/layout.css" />

    <style>
      /* --------- PAGE WRAPPER --------- */
      .home-shell {
        margin: 0 auto;
      }

      .home-main {
        padding-top: 24px;
        padding-bottom: 32px;
      }

      /* --------- HERO --------- */
      .home-hero {
        display: grid;
        grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
        gap: 32px;
        align-items: center;
        margin-bottom: 36px;

        opacity: 0;
        transform: translateY(20px);
        animation: heroIn 0.6s ease-out forwards;
      }

      @keyframes heroIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .home-kicker {
        font-size: 11px;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        color: #9ca3af;
        margin-bottom: 8px;
      }

      .home-title {
        font-size: 40px;
        font-weight: 800;
        line-height: 1.05;
        margin: 0 0 12px;
      }

      .home-highlight {
        background: linear-gradient(135deg, #22c55e, #06b6d4, #a855f7);
        background-clip: text;
        -webkit-background-clip: text;
        color: transparent;
      }

      .home-sub {
        font-size: 15px;
        color: #9ca3af;
        max-width: 540px;
        margin: 0 0 22px;
      }

      .home-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      .home-btn {
        padding: 10px 22px;
        border-radius: 999px;
        font-size: 14px;
        border: none;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition:
          transform 0.18s ease,
          box-shadow 0.18s ease;
      }

      .home-btn-primary {
        background: #22c55e;
        color: #020617;
        font-weight: 700;
        box-shadow: 0 10px 30px rgba(34, 197, 94, 0.45);
      }

      .home-btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 14px 36px rgba(34, 197, 94, 0.6);
      }

      .home-btn-secondary {
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        border: 1px solid #1f2937;
      }

      .home-btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
      }

      .home-btn .arrow {
        font-size: 15px;
      }

      /* Right side hero card */
      .home-feature-card {
        background: rgba(2, 6, 23, 0.96);
        border-radius: 22px;
        padding: 18px 20px;
        box-shadow: 0 0 30px rgba(15, 23, 42, 0.9);
        border: 1px solid #1f2937;
        max-width: 420px; /* Increased by 50% from 280px */
        margin: 0 auto; /* Center it */
      }

      .home-feature-label {
        font-size: 13px;
        color: #9ca3af;
        margin-bottom: 10px;
      }

      .home-feature-frame {
        position: relative;
        padding: 2px;
        border-radius: 18px;
        background: linear-gradient(135deg, #22c55e, #06b6d4, #8b5cf6);
        box-shadow: 0 0 26px rgba(0, 0, 0, 0.8);
        animation: glowPulse 4s ease-in-out infinite;
        cursor: pointer;
      }

      @keyframes glowPulse {
        0%,
        100% {
          box-shadow: 0 0 22px rgba(56, 189, 248, 0.6);
        }
        50% {
          box-shadow: 0 0 30px rgba(34, 197, 94, 0.8);
        }
      }

      .home-feature-inner {
        border-radius: 16px;
        background: #0b1120;
        padding: 16px 18px;
      }

      .home-feature-header {
        display: flex;
        gap: 14px;
        align-items: center;
        margin-bottom: 12px;
      }

      .home-feature-avatar {
        width: 80px;
        height: 80px;
        border-radius: 16px;
        object-fit: cover;
        background: #020617;
        flex-shrink: 0;
      }

      .home-feature-text {
        display: flex;
        flex-direction: column;
        gap: 3px;
        min-width: 0;
        flex: 1;
      }

      .home-feature-name {
        font-size: 18px; /* Increased by 50% from 14px */
        font-weight: 700;
        line-height: 1.2;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: #e5e7eb;
      }

      .home-feature-team {
        font-size: 13px; /* Increased by 50% from 11px (rounded) */
        color: #9ca3af;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .home-feature-car {
        font-size: 12px; /* Increased by 50% from 10px (rounded) */
        color: #a5b4fc;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .home-feature-footer {
        font-size: 11px; /* Increased by 50% from 9px (rounded) */
        color: #9ca3af;
        margin-top: 6px; /* Increased from 4px */
        line-height: 1.3;
      }

      .home-feature-stats {
        font-size: 12px;
        color: #e5e7eb;
        line-height: 1.6;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px solid rgba(31, 41, 55, 0.5);
      }

      .home-feature-stats b {
        color: #9ca3af;
        font-weight: 600;
      }

      /* Free Agent pills (if not already in layout.css) */
      .home-free-agent-row {
        display: flex;
        align-items: center;
        gap: 6px; /* Increased by 50% from 4px */
        margin-top: 4px; /* Increased from 3px */
        font-size: 12px; /* Increased by 50% from 10px (rounded) */
        color: #9ca3af;
        flex-wrap: wrap;
      }
      .home-free-agent-label {
        color: #9ca3af;
        font-size: 11px; /* Increased by 50% from 9px (rounded) */
      }
      .home-free-agent-pill {
        padding: 2px 8px; /* Increased from 2px 6px */
        border-radius: 999px;
        border: 1px solid #1f2937;
        background: rgba(15, 23, 42, 0.7);
        color: #e5e7eb;
        font-size: 11px; /* Increased by 50% from 9px (rounded) */
      }
      .home-free-agent-pill.home-active {
        border-color: rgba(34, 197, 94, 0.7);
        background: rgba(34, 197, 94, 0.15);
        color: #bbf7d0;
      }

      /* --------- LEAGUE STATS STRIP --------- */
      .home-stats-strip {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 12px;
        margin-bottom: 26px;
      }

      .home-stat-card {
        background: rgba(2, 6, 23, 0.9);
        border-radius: 14px;
        padding: 10px 12px;
        border: 1px solid #111827;
        box-shadow: 0 0 16px rgba(15, 23, 42, 0.7);
        font-size: 13px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .home-stat-label {
        color: #9ca3af;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      .home-stat-value {
        font-size: 18px;
        font-weight: 700;
      }

      .home-stat-sub {
        font-size: 11px;
        color: #6b7280;
      }

      /* --------- FEATURE TILES --------- */
      .home-section-title {
        font-size: 16px;
        font-weight: 600;
        margin: 0 0 10px;
      }

      .home-tiles {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 18px;
        margin-bottom: 32px;
      }

      .home-tile {
        background: rgba(2, 6, 23, 0.96);
        border-radius: 16px;
        padding: 14px 16px;
        box-shadow: 0 0 18px rgba(15, 23, 42, 0.8);
        border: 1px solid #111827;
        transition:
          transform 0.18s ease,
          box-shadow 0.18s ease;
      }

      .home-tile:hover {
        transform: translateY(-4px);
        box-shadow: 0 14px 30px rgba(15, 23, 42, 0.9);
        border-color: #22c55e66;
      }

      .home-tile h3 {
        margin: 0 0 6px;
        font-size: 15px;
      }

      .home-tile p {
        margin: 0;
        font-size: 13px;
        color: #9ca3af;
      }

      .home-tile a {
        display: inline-block;
        margin-top: 10px;
        font-size: 12px;
        color: #38bdf8;
        text-decoration: none;
      }

      .home-tile a:hover {
        text-decoration: underline;
      }

      /* --------- UPCOMING + HOW IT WORKS --------- */
      .home-lower-grid {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
        gap: 20px;
        margin-bottom: 28px;
      }

      .home-card {
        background: rgba(2, 6, 23, 0.96);
        border-radius: 16px;
        padding: 16px 18px;
        box-shadow: 0 0 18px rgba(15, 23, 42, 0.8);
        border: 1px solid #111827;
      }

      .home-card-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 8px;
      }

      .home-card-title {
        font-size: 15px;
        font-weight: 600;
      }

      .home-pill {
        font-size: 11px;
        padding: 3px 10px;
        border-radius: 999px;
        background: rgba(34, 197, 94, 0.12);
        color: #bbf7d0;
        border: 1px solid rgba(34, 197, 94, 0.4);
      }

      .home-upcoming-meta {
        font-size: 13px;
        color: #9ca3af;
        margin-bottom: 10px;
      }

      .home-upcoming-row {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        font-size: 13px;
        margin-bottom: 10px;
      }

      .home-upcoming-label {
        color: #6b7280;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
      }

      .home-upcoming-track {
        font-weight: 600;
      }

      .home-upcoming-btn {
        margin-top: 10px;
        font-size: 12px;
        padding: 7px 16px;
        border-radius: 999px;
        border: 1px solid #22c55e;
        background: transparent;
        color: #bbf7d0;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition:
          transform 0.18s ease,
          box-shadow 0.18s ease;
      }

      .home-upcoming-btn:hover {
        background: rgba(34, 197, 94, 0.1);
        transform: translateY(-2px);
      }

      .home-steps {
        list-style: none;
        padding: 0;
        margin: 10px 0 0;
        display: grid;
        gap: 8px;
        font-size: 13px;
      }

      .home-step {
        display: grid;
        grid-template-columns: 24px minmax(0, 1fr);
        gap: 8px;
        align-items: flex-start;
      }

      .home-step-number {
        width: 22px;
        height: 22px;
        border-radius: 999px;
        background: #020617;
        border: 1px solid #1f2937;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        color: #e5e7eb;
      }

      .home-step-title {
        font-weight: 600;
        margin-bottom: 2px;
      }

      .home-step-text {
        color: #9ca3af;
      }

      /* --------- COMMUNITY STRIP --------- */
      .home-community {
        text-align: center;
        font-size: 13px;
        color: #9ca3af;
      }

      .home-community span {
        color: #e5e7eb;
        font-weight: 500;
      }

      .home-community a {
        color: #38bdf8;
        text-decoration: none;
        margin-left: 4px;
      }

      .home-community a:hover {
        text-decoration: underline;
      }

      /* --------- RESPONSIVE --------- */
      @media (max-width: 960px) {
        .home-hero {
          grid-template-columns: minmax(0, 1fr);
        }

        .home-lower-grid {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      @media (max-width: 720px) {
        .home-stats-strip {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .home-tiles {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      @media (max-width: 480px) {
        .home-title {
          font-size: 32px;
        }

        .home-sub {
          font-size: 14px;
        }

        .home-buttons {
          flex-direction: column;
        }

        .home-btn {
          width: 100%;
          justify-content: center;
        }

        .home-stats-strip {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .home-stat-value {
          font-size: 20px;
        }

        .home-feature-card {
          max-width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <div class="sgp-shell home-shell">
      <!-- Shared header -->
      <header class="sgp-header">
        <div class="sgp-logo-block">
          <div class="sgp-logo">Solana Grand Prix</div>
          <div class="sgp-tagline">IRACING • LEAGUE • STATS • CRYPTO</div>
        </div>

        <div class="sgp-header-right">
          <nav class="sgp-nav">
            <a href="/" class="sgp-nav-link active">Home</a>
            <a href="/tracker" class="sgp-nav-link">Drivers</a>
            <a href="/season" class="sgp-nav-link">Season Hub</a>
            <a href="/card-builder" class="sgp-nav-link">Card Builder</a>
            <a href="/leaderboard" class="sgp-nav-link">Leaderboard</a>
            <a href="/auth" class="sgp-nav-link">Account</a>
          </nav>

          <!-- username slot -->
          <div id="sgp-user" class="sgp-userbox"></div>
        </div>
      </header>

      <!-- Page content -->
      <main class="sgp-main home-main">
        <!-- HERO -->
        <section class="home-hero">
          <div>
            <div class="home-kicker">On-chain racing league</div>
            <h1 class="home-title">
              The <span class="home-highlight">Solana Grand Prix</span> iRacing league.
            </h1>

            <p class="home-sub">
              Weekly degen race nights, Mazda Cup chaos, GT3 door-banging and on-chain culture.
              Track live stats, season standings and collectible driver cards built for the Solana
              community.
            </p>

            <div class="home-buttons">
              <a href="/tracker" class="home-btn home-btn-primary">
                Enter driver stats <span class="arrow">↗</span>
              </a>
              <a href="/season" class="home-btn home-btn-secondary">
                View Season 1 hub
              </a>
              <a href="/card-builder" class="home-btn home-btn-secondary">
                Card Builder
              </a>
            </div>
          </div>

          <aside class="home-feature-card">
            <div class="home-feature-label">Featured Driver</div>

            <div class="home-feature-frame" id="featured-link" role="button" tabindex="0">
              <div class="home-feature-inner">
                <div class="home-feature-header">
                  <img
                    id="featured-avatar"
                    src="/images/riley.png"
                    class="home-feature-avatar"
                    alt="Featured driver"
                  />
                  <div class="home-feature-text">
                    <div id="featured-name" class="home-feature-name">#93 Lemon</div>
                    <div id="featured-team" class="home-feature-team">SolanaGP</div>
                    <div id="featured-car" class="home-feature-car">Mazda MX-5 Cup</div>

                    <div class="home-free-agent-row">
                      <span class="home-free-agent-label">Free Agent:</span>
                      <span id="featured-fa-yes" class="home-free-agent-pill home-active">Yes</span>
                      <span id="featured-fa-no" class="home-free-agent-pill">No</span>
                    </div>
                  </div>
                </div>
                <div id="featured-stats" class="home-feature-stats" style="display: none;">
                  <b>iRating:</b> <span id="featured-irating">0</span><br>
                  <b>License:</b> <span id="featured-license">Rookie</span><br>
                  <b>Starts:</b> <span id="featured-starts">0</span><br>
                  <span id="featured-wins" style="display: none;"></span>
                  <span id="featured-podiums" style="display: none;"></span>
                </div>
              </div>
            </div>
          </aside>
        </section>

        <!-- LEAGUE STATS STRIP -->
        <section class="home-stats-strip">
          <div class="home-stat-card">
            <div class="home-stat-label">Season</div>
            <div class="home-stat-value">01</div>
            <div class="home-stat-sub">Mazda Cup launch season</div>
          </div>
          <div class="home-stat-card">
            <div class="home-stat-label">Drivers</div>
            <div class="home-stat-value" id="driver-count">—</div>
            <div class="home-stat-sub">Ready to scale</div>
          </div>
          <div class="home-stat-card">
            <div class="home-stat-label">Races</div>
            <div class="home-stat-value">Weekly</div>
            <div class="home-stat-sub">Live stat tracking &amp; recaps</div>
          </div>
          <div class="home-stat-card">
            <div class="home-stat-label">Class</div>
            <div class="home-stat-value">Mazda MX-5 Cup</div>
            <div class="home-stat-sub">Future: multiclass &amp; rallies</div>
          </div>
        </section>

        <!-- FEATURE TILES -->
        <section>
          <h2 class="home-section-title">What you can do</h2>
          <div class="home-tiles">
            <div class="home-tile">
              <h3>Drivers</h3>
              <p>
                See iRating, license, starts and recent results for every SolanaGP driver. Deep-dive
                on dedicated profile pages with graphs and history.
              </p>
              <a href="/tracker">Open Drivers ↗</a>
            </div>

            <div class="home-tile">
              <h3>Season Hub</h3>
              <p>
                Follow the full calendar, results, standings and storylines for each season. Perfect
                for race broadcasts, recap threads and league docs.
              </p>
              <a href="/season">View Season 1 hub ↗</a>
            </div>

            <div class="home-tile">
              <h3>Card Builder</h3>
              <p>
                Generate animated driver cards with rarity frames, export high-res PNGs and drop
                them on Solana. Use them for overlays, merch or NFT drops.
              </p>
              <a href="/card-builder">Launch Card Builder ↗</a>
            </div>
          </div>
        </section>

        <!-- UPCOMING EVENT + HOW IT WORKS -->
        <section class="home-lower-grid">
          <!-- Upcoming -->
          <article class="home-card">
            <div class="home-card-header">
              <div class="home-card-title">Next Event</div>
              <span class="home-pill">TBD</span>
            </div>

            <div class="home-upcoming-meta">
              All dates / times are placeholder data until the live calendar is wired in.
            </div>

            <div class="home-upcoming-row">
              <div>
                <div class="home-upcoming-label">Track</div>
                <div class="home-upcoming-track">TBD</div>
              </div>
              <div>
                <div class="home-upcoming-label">Car</div>
                <div>Mazda MX-5 Cup</div>
              </div>
              <div>
                <div class="home-upcoming-label">Format</div>
                <div>35 min</div>
              </div>
            </div>

            <a href="/season" class="home-upcoming-btn">
              View full calendar <span>↗</span>
            </a>
          </article>

          <!-- How it works -->
          <article class="home-card">
            <div class="home-card-header">
              <div class="home-card-title">How SolanaGP works</div>
            </div>

            <ul class="home-steps">
              <li class="home-step">
                <div class="home-step-number">1</div>
                <div>
                  <div class="home-step-title">Mint or Purchase</div>
                  <div class="home-step-text">Obtain one of the driver NFTs.</div>
                </div>
              </li>
              <li class="home-step">
                <div class="home-step-number">2</div>
                <div>
                  <div class="home-step-title">Race, log, repeat</div>
                  <div class="home-step-text">
                    As you participate in our events your driver will be rewarded and given custom
                    stats.
                  </div>
                </div>
              </li>
              <li class="home-step">
                <div class="home-step-number">3</div>
                <div>
                  <div class="home-step-title">Build your legacy</div>
                  <div class="home-step-text">
                    Build and customize your driver to leave a legacy.
                  </div>
                </div>
              </li>
            </ul>
          </article>
        </section>

        <!-- COMMUNITY CTA -->
        <section class="home-community">
          <span>Want to help shape Season 1?</span>
          <a href="/tracker">Add your driver and send feedback ↗</a>
        </section>
      </main>

      <!-- Shared footer -->
      <footer class="sgp-footer">
        Solana Grand Prix
      </footer>
    </div>

    <script src="/global-user.js"></script>
    <script src="/card-customization.js"></script>

    <script>
      (function () {
        function getToken() {
          return localStorage.getItem('sgp_token');
        }

        function setFreeAgentUI(isFreeAgent) {
          var yes = document.getElementById('featured-fa-yes');
          var no = document.getElementById('featured-fa-no');
          if (!yes || !no) return;

          if (isFreeAgent) {
            yes.classList.add('home-active');
            no.classList.remove('home-active');
          } else {
            yes.classList.remove('home-active');
            no.classList.add('home-active');
          }
        }

        function wireFeaturedLink(driverKey) {
          var linkEl = document.getElementById('featured-link');
          if (!linkEl || !driverKey) return;

          function go() {
            // Navigate to drivers page
            window.location.href = '/tracker';
          }

          linkEl.onclick = go;
          linkEl.onkeydown = function (e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              go();
            }
          };
        }

        async function refreshFeaturedDriver() {
          try {
            // Get featured driver from API (no cache to ensure fresh data)
            var featuredRes = await fetch('/api/featured-driver', { cache: 'no-store' });
            if (!featuredRes.ok) {
              return;
            }

            var featuredData = await featuredRes.json();
            var driverKey = (featuredData.driverKey || 'lemon').toLowerCase();
            if (!driverKey) {
              return;
            }

            wireFeaturedLink(driverKey);

            // Pull featured driver profile (no cache to ensure fresh data)
            var statsRes = await fetch('/api/stats?driver=' + encodeURIComponent(driverKey), { cache: 'no-store' });
            if (!statsRes.ok) {
              return;
            }

            var stats = await statsRes.json();

            var avatarEl = document.getElementById('featured-avatar');
            var nameEl = document.getElementById('featured-name');
            var teamEl = document.getElementById('featured-team');
            var carEl = document.getElementById('featured-car');
            var featuredCardEl = document.getElementById('featured-link');

            // Update avatar
            if (avatarEl) {
              if (stats.avatar) {
                avatarEl.src = stats.avatar;
              }
              if (stats.name) {
                avatarEl.alt = stats.name + ' avatar';
              }
            }

            // Update text fields - EXACT match to driver profile page structure
            var number = typeof stats.number !== 'undefined' && stats.number !== null && stats.number !== 0 ? stats.number : '';
            var display = stats.name || stats.displayName || 'Driver';

            if (nameEl) {
              nameEl.textContent = (number ? '#' + number + ' ' : '') + display;
            }
            if (teamEl) {
              // Match profile page exactly - show empty string if no team
              teamEl.textContent = stats.team || '';
            }
            if (carEl) {
              carEl.textContent = stats.primaryCar || 'Mazda MX-5 Cup';
            }

            // Update Free Agent status
            setFreeAgentUI(!!stats.freeAgent);

            // Update stats section (matching card builder preview)
            var statsEl = document.getElementById('featured-stats');
            var iratingEl = document.getElementById('featured-irating');
            var licenseEl = document.getElementById('featured-license');
            var startsEl = document.getElementById('featured-starts');
            var winsEl = document.getElementById('featured-wins');
            var podiumsEl = document.getElementById('featured-podiums');

            if (statsEl && iratingEl && licenseEl && startsEl) {
              statsEl.style.display = 'block';
              iratingEl.textContent = (stats.irating ?? 0).toLocaleString();
              licenseEl.textContent = stats.license || 'Rookie';
              startsEl.textContent = (stats.starts ?? 0).toLocaleString();

              // Show wins and podiums if available (matching card builder format exactly)
              if (winsEl && stats.wins !== undefined) {
                winsEl.style.display = '';
                winsEl.innerHTML = `<b>Wins:</b> ${stats.wins} &nbsp;&nbsp;`;
              } else if (winsEl) {
                winsEl.style.display = 'none';
              }

              if (podiumsEl && stats.podiums !== undefined) {
                podiumsEl.style.display = '';
                podiumsEl.innerHTML = `<b>Podiums:</b> ${stats.podiums}`;
              } else if (podiumsEl) {
                podiumsEl.style.display = 'none';
              }
            }

            // Apply card customizations if available
            if (featuredCardEl) {
              // Clear any existing customizations first
              featuredCardEl.style.cssText = '';
              const innerEl = featuredCardEl.querySelector('.home-feature-inner');
              if (innerEl) {
                innerEl.style.cssText = '';
              }
              
              // Apply new customizations
              if (stats.cardCustomization && typeof window.applyCardCustomization === 'function') {
                try {
                  let customization = typeof stats.cardCustomization === 'string' 
                    ? JSON.parse(stats.cardCustomization) 
                    : stats.cardCustomization;
                  
                  if (customization && typeof customization === 'object' && Object.keys(customization).length > 0) {
                    // Use a small delay to ensure DOM is ready
                    setTimeout(() => {
                      window.applyCardCustomization(featuredCardEl, customization, stats);
                    }, 50);
                  }
                } catch (customErr) {
                  console.error('Error applying card customization:', customErr);
                }
              }
            }
          } catch (err) {
            console.error('Error refreshing featured driver:', err);
          }
        }

        // Load driver count
        async function loadDriverCount() {
          try {
            const res = await fetch('/api/driver-count');
            if (!res.ok) return;
            
            const data = await res.json();
            const countEl = document.getElementById('driver-count');
            if (countEl && data.count !== undefined) {
              countEl.textContent = data.count + '+';
            }
          } catch (err) {
            console.error('Error loading driver count:', err);
          }
        }

        // initial load
        refreshFeaturedDriver();
        loadDriverCount();

        // update live after save on profile page
        window.addEventListener('sgp:driver-updated', function () {
          refreshFeaturedDriver();
          loadDriverCount(); // Refresh count when driver updates
        });

        // Listen for featured driver changes from admin panel
        window.addEventListener('sgp:featured-driver-updated', function () {
          refreshFeaturedDriver();
        });

        // Periodically refresh featured driver to catch any changes (every 30 seconds)
        setInterval(function() {
          refreshFeaturedDriver();
        }, 30000);
        
        // Also listen for driver count updates from drivers page
        window.addEventListener('sgp:driver-count-updated', function (e) {
          const countEl = document.getElementById('driver-count');
          if (countEl && e.detail && e.detail.count !== undefined) {
            countEl.textContent = e.detail.count + '+';
          }
        });
      })();
    </script>
  </body>
</html>
