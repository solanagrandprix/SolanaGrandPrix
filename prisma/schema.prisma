datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "windows", "linux-musl-openssl-3.0.x"]
}

model User {
  id                Int      @id @default(autoincrement())
  username          String   @unique
  passwordHash      String
  isAdmin           Boolean  @default(false)
  driver            Driver?
  deletionRequest   DeletionRequest?
  createdAt         DateTime @default(now())
  // updatedAt temporarily removed - column doesn't exist in database
  // updatedAt         DateTime @updatedAt
}

model Driver {
  id           Int      @id @default(autoincrement())
  userId       Int      @unique
  user         User     @relation(fields: [userId], references: [id])

  driverKey    String   @unique
  displayName String

  number       Int      @default(0)
  team         String   @default("Privateer")
  primaryCar  String   @default("Mazda MX-5 Cup")
  avatar      String   @default("/images/riley.png")

  irating     Int      @default(0)
  license     String   @default("Rookie")
  starts      Int      @default(0)
  freeAgent   Boolean  @default(true)

  xpTotal     Int      @default(0)
  xpLevel     Int      @default(1)
  xpToNext    Int      @default(500)
  skillTier   String   @default("Beginner")
  bestFinish  Int      @default(0)
  winRate     Float    @default(0)
  totalPurse Int      @default(0)

  preferredClasses String?
  country          String?
  timezone         String?
  twitch           String?
  twitter          String?
  discord          String?
  iracing          String? // iRacing username/ID for API connection
  solanaWallet     String? // Solana wallet address (base58 encoded public key)
  driverNotes      String?
  cardCustomization String? // JSON string storing card customization settings

  achievements     Achievement[] // Achievements unlocked by this driver

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Achievement {
  id          Int      @id @default(autoincrement())
  name        String
  description String
  icon        String?  // Emoji or icon identifier
  xpReward    Int      @default(0) // XP awarded when unlocked
  rarity      String   @default("Common") // Common, Rare, Epic, Legendary
  category    String?  // e.g., "Racing", "Social", "Milestone"
  isActive    Boolean  @default(true) // Whether this achievement is currently available
  
  driverId    Int?     // If null, this is a global achievement template
  driver      Driver?  @relation(fields: [driverId], references: [id])
  
  unlockedAt  DateTime? // When this achievement was unlocked (null for templates)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model DeletionRequest {
  id          Int      @id @default(autoincrement())
  userId      Int      @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  reason      String?  // Optional reason provided by user
  status      String   @default("pending") // pending, approved, denied
  reviewedBy  Int?     // Admin user ID who reviewed the request
  reviewedAt  DateTime?
  notes       String?  // Admin notes about the review
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model CalendarEvent {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  eventDate   DateTime // Date and time of the event
  eventType   String   @default("race") // race, practice, qualifier, special, etc.
  track       String?
  carClass    String?
  status      String   @default("scheduled") // scheduled, completed, cancelled, postponed
  isActive    Boolean  @default(true)
  createdBy   Int?     // Admin user ID who created the event
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
